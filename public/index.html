<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–°—Ç—É–¥–µ–Ω—Ç—Å—å–∫–∏–π —Ñ–æ—Ä—É–º –õ–ù–£</title>
    <link rel="stylesheet" href="style.css">

    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
    <script src="config.js"></script>
</head>
<body>

    <div id="login-screen" class="container" style="text-align: center; margin-top: 100px;">
        <h1>üîê –í—Ö—ñ–¥ —É —Å–∏—Å—Ç–µ–º—É</h1>
        <p>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—É –ø–æ—à—Ç—É (@lnu.edu.ua)</p>
        
        <div class="post-form" style="max-width: 400px; margin: 0 auto;">
            <button onclick="loginWithMicrosoft()">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Microsoft</button>
            <p id="login-error" style="color: red; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="forum-screen" class="container" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>üéì –§–æ—Ä—É–º –õ–ù–£</h1>
            <button onclick="logout()" style="width: auto; background: #666;">–í–∏–π—Ç–∏</button>
        </div>
        
        <div class="post-form">
            <p>–ü—Ä–∏–≤—ñ—Ç, <strong id="current-user-display">Student</strong>!</p>
            <textarea 
                id="message" 
                placeholder="–ù–æ–≤–∞ —Ç–µ–º–∞..." 
                autocomplete="off"
                rows="1" 
                style="resize: none; overflow: hidden;"
                oninput="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px'"
            ></textarea>
            
            <button onclick="sendPost()">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</button>
            <p id="status-msg"></p>
        </div>
        <div id="posts-list"></div>
    </div>

    <script src="script.js"></script>

    <script>
        const msalInstance = new msal.PublicClientApplication({
            auth: {
                clientId: MSA_CONFIG.clientId,
                authority: MSA_CONFIG.authority,
                redirectUri: MSA_CONFIG.redirectUri
            }
        });

        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                showForumScreen(savedUser);
            }
        });

        async function loginWithMicrosoft() {
            try {
                const response = await msalInstance.loginPopup();
                const username = response.account.username;
                
                localStorage.setItem('currentUser', username);
                
                showForumScreen(username);

            } catch (error) {
                console.error(error);
                document.getElementById('login-error').innerText = "–ü–æ–º–∏–ª–∫–∞: " + error.message;
            }
        }

        function showForumScreen(username) {
            document.getElementById('current-user-display').innerText = username;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('forum-screen').style.display = 'block';

            if (typeof renderPosts === "function") {
                renderPosts();
            } else if (typeof loadPosts === "function") {
                loadPosts();
            } else {
                console.log("–£–≤–∞–≥–∞: –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –ø–æ–∫–∞–∑—É –ø–æ—Å—Ç—ñ–≤ —É script.js");
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            location.reload();
        }
    </script>
</body>
</html>